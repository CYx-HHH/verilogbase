## 1.平台-Xilinx Intel-ALTERA 安陆-国产 复旦微（军品）
云汉芯域

### 1.1 主流使用Xilinx AMD7系列 XC7KU

评估资源-选型:  

- 逻辑单元xxT-xxK； 
最好留40%预量-上限50k左右；    
*（为什么？以防项目突发情况/布局拥堵-效果不好时序可能会差/预留debug*

- 需要的RAM资源；
- 根据需要的特殊功能点选择，比如：DDR，PCIE，高速通信GTP等。

### 1.2 安陆 主打凤凰系列（LUTs逻辑资源量
分布式RAM资源量不靠谱，需要问一下

### 1.3 高云 低端路线
## 2.开发环境
### 2.1 平台使用
    Xilinx开发环境 ISE,VIVADO
    Intel-ALTERA Quartus Prime
    安陆 TD
    
目前使用版本：
    
    Xilinx zynq7010 xc7z010clg484-1, zynq7035 xc7z035ffg676-2
    飓风10
    VIVADO17.4 
使用IP Catalog可以查询原语；RTL（寄存器）模型分析，可以生成原理图。

### 2.2 Quartus17.1

### 2.3 安陆 anlogic TD
 不能和module sim联合仿真，需要自己写脚本文件将IP工程和module sim仿真联合到一起


## 3.人电合一
- 软件 Proteus8.6 仿真计数器
大位宽赋值给小位宽是可以的（自动截低位）
- LUTs万能组件，与或非异或门等。
*级联太多会导致电路时延*

## 4.LED灯闪烁
### 4.1 PLL锁相环，时钟分频器、倍频器、调整相位。
Xilinx分频为5M，Altera分配为1M，统一为兼容5M-ns级别
*计数器位宽-一般16bit 100M以下可以32bit ？？？*

锁相环在Xilinx里叫时钟组件：*clocking wizard*。它可识别输入时钟信号的相位，根据参数生成多路指定时钟。

使用PLL锁相环设置模式MMCM/PLL，基础功能都是一样的，PLL是模拟电路做的锁相环，MMCM是数字电路实现的器件。环是指有回路。区别在于：MMCM有调相功能PLL没有。

输入时钟按板子信号设置，输出把复位去掉（晶振不做复位）。生成IP核，然后从实例化模板调用IP核。

锁相信号-需要一段时间才能保持稳定，锁相环在时钟没分频完要设置0，分频完再设置1。

*板子上的晶振质量不好不建议直接使用。*

### 4.2 IP核使用-FPGA中厂商设计好的模块，比较稳定不易出错，优先使用IP核

#### 4.2.1 给FPGA产生时钟的器件叫晶振，产生固定频率的方波，触发FPGA时序电路运行；
#### 4.2.2 FPGA内部没有集成晶振，功耗体积非常小；晶振体积大；        

### 4.3 时钟分频器，PLL分频时钟都是M级别，将M分为K。

大概是5M到1Khz时钟。

### 4.4 IO物理约束-绑定具体控制引脚
### 4.5 Xilinx上板验证


## 5 双平台兼容-Xilinx-ALTERA QUARTUS
不同平台间主要是IP核不一样。

## 6 FPGA常见电平标准
- 单端信号 信号由一根线输出，一个io口，+5/3V3为高电平，0低电平
- 差分信号 信号由两根线输出，两个io口，两个信号线之间的电压差为高低电平，
- 双绞线/网线，抗干扰强，理论最高频率2G，实际3.4MHZ，好的到7-800MHZ。

- TTL 三极管单端输出（串口模块，USB-电脑标准转TTL-板子上io电平标准）
三极管特性决定信号反转不会很快，功耗比较大，一般几十MHZ

- CMOS MOS管单端输出-功耗低反转快，频率信号<=200M；推荐<=150MHZ

- LVDS 低压差分信号
LV-低压
- LVPECL 高速差分 PECL差值更大，抗干扰更强，功耗更大，速度更快
当外部输入电平为LVPECL而FPHGA为LVDS时，硬件需要使用电阻网络将LVPECL转为LVDS

- TMDS 差分，针对HDMI视频传输

- SSTL，HSTL 专用于DDR存储器的单端标准


压摆率即转换速率：是运算放大器输出电压的转换速率，单位V/s，V/ms，V/us，是运算放大器在速度方面的指标。一般情况下，压摆率越高的运放，工作电流也越大，即耗电也越大。

时钟抖动-单位ppm

占分比：高电平/低电平比值


VIVADO差分信号 _p _n：只能调用VIVADO的obuf原语设置差分信号，不能直接赋值。使用原语控制器件-将单端信号转为差分信号，只约束p端即可。

LVDS供电事项-2.5V/1.8V。
在使用LVDS时，需要将LVDS的供电电压设置为2.5V，而不是1.8V，否则会出现LVDS信号不稳定的情况。
如果BANK供电为3.3V，只能使用LVDS的接收功能。


## 7 RAM的IP核设置
RAM可以在fpga里跨时钟域---fpga里有多个时钟，多时序间数据传输可借助RAM缓存数据。

**块存储器BlockMemory/BRAM**：两个18kb可以组合成36kb的RAM。BRAM是串行器件，一个时钟只能操作一个存储单元（8bit位宽）

**分布式RAM**使用FPGA内的D触发器。缺点是占用reg资源，持续没有BRAM好，优点是读取更灵活。

**单端口RAM**---读写

**双端口RAM**---两个操作端口：
  - **简单双端口**，一个在只写，一个只读。
  - **真双端口**，做了两块真正的RMA，两个端口均可读写


### 单端口
一般选择面积最小的
   - 数据位宽-指每个存储单元位数
   - 读写深度-有多少个存储单元
#### ena使能---ram使能/写使能
    ram使能 - 高电平则RAM工作，一直读addr地址的数据
    写使能  - 拉高一个周期，写一个单位的数据，将输入端口数据写入
    
    读潜伏期：刚拉高使能的时候，RAM接收高位信号会在下个时钟周期执行，即读潜伏期为1；等待两个周期则为2
    
    写同步周期：RAM写数据等待一个周期可以读取，则写同步周期为1；等待两个周期可以读取，则为2。
    
**输出寄存器选项**：寄存器赋值要延迟一个周期；使用输出寄存器reg，则默认RAM读潜伏期为2，常用是取消此选项。

*器件起名：BRAM_位宽\*深度，8*1024*

OOC综合，Out of context per IP：可以减少综合时间，将IP变成网表加载；选global，每次重新综合的时间长。

.vho是VHDL模板；.veo是verilog模板.

### RAM实例化使用-存入/读出数据
锁相信号是低有效复位，上电低电平后面拉高，因此是低有效复位。
    
仿真：
    初始化块，只执行一遍，begin end内顺序执行；“#” 延时语句。

**timescale宏**用于标识，延时单位1ns / 仿真精度1ps 仿真精度最小单位1皮秒

### FIFO使用-写入0-1023，读出0-1023
*FIFO命名：FIFO_8*1024,位宽*深度。*    
基础类型：Native/AXI Mapped类/AXI Stream类型。

移位寄存器shift构成的FIFO，移位寄存器很宝贵；

builtin FIFO是硬核FIFO。一般使用BRAM，是软核FIFO。
    
同步周期，数据同步到稳定态的周期数，等待周期稳定存入数据，默认2。

### full信号，数据写满；Almost Full Flag，几乎满给信号；
prog_full，可编程满，达到内存阈值时会拉高信号。

Native Ports 
- 标准FIFO 
- First Word Fall Through 无条件提前输出一个数据

FIFO复位信号，至少要持续12个周期才会复位成功。（为什么？？

DataCount，数数据，不好用。（这里说的应该是IP核的选项。

### 复位信号
当输出时钟稳定之后，锁相信号拉高。系统一般高电平复位，
可将锁相信号取反来实现复位。




















